#!/bin/bash
# SPDX-License-Identifier: GPL-2.0-or-later
# Copyright (C) 2021-present pkegg

#Constants
CONSOLE_DEVICE=/dev/console
. /etc/profile

DIR=$(realpath $(dirname $0))
BAND=$(get_ee_setting updates.type)

systemctl stop emustation

# Ensure we start emustation back up at end
function cleanup {
  clear > ${CONSOLE_DEVICE}
  systemctl start emustation

}
trap cleanup EXIT

clear > ${CONSOLE_DEVICE}
show_splash "$0"
clear > ${CONSOLE_DEVICE}

python3 ${DIR}/get-release.py --band ${BAND} --org pkegg
RETURN_CODE=$?

if [ "${RETURN_CODE}" != "0" ]
then
  exit 1
else
  sync
  reboot
fi